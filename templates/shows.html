{% extends 'base.html' %}
{% block content %}
<h2 class="mb-3">Shows</h2>
<form class="row g-2 mb-3" method="get">
  <div class="col-md-4">
    <input type="text" class="form-control" name="movie" placeholder="Search movie title" value="{{ filters.movie }}">
  </div>
  <div class="col-md-3">
    <input type="date" class="form-control" name="date" value="{{ filters.date }}">
  </div>
  <div class="col-md-3">
    <input type="text" class="form-control" name="theatre" placeholder="Theatre name" value="{{ filters.theatre }}">
  </div>
  <div class="col-md-2 d-grid">
    <button type="submit" class="btn btn-primary">Filter</button>
  </div>
</form>

{% if shows %}
  <div class="row g-3">
    {% for s in shows %}
    <div class="col-md-6 col-lg-4">
      <div class="card h-100">
        <div class="card-body">
          <h5 class="card-title mb-1">{{ s.movie_title }}</h5>
          <div class="text-muted mb-2">{{ s.theatre_name }} · {{ s.screen_name }} ({{ s.screen_type }})</div>
          <div class="d-flex justify-content-between">
            <div>
              <div><span class="fw-semibold">Date:</span> {{ s.show_date }}</div>
              <div><span class="fw-semibold">Time:</span> {{ s.show_time }}</div>
            </div>
            <div class="text-end">
              <div><span class="fw-semibold">Price:</span> ₹ {{ '%.2f'|format(s.base_price) }}</div>
              <div><span class="fw-semibold">Avail:</span> {{ s.available_seats }}</div>
            </div>
          </div>
        </div>
        <div class="card-footer bg-transparent border-top-0 d-grid">
          <a class="btn btn-success" href="{{ url_for('booking.book_ticket_get') }}?show_id={{ s.show_id }}">Book Now</a>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  {% if pages and pages > 1 %}
  <nav class="mt-3" aria-label="Shows pagination">
    <ul class="pagination">
      <li class="page-item {% if page <= 1 %}disabled{% endif %}">
        <a class="page-link" href="?movie={{ filters.movie }}&theatre={{ filters.theatre }}&date={{ filters.date }}&page={{ page-1 }}">Prev</a>
      </li>
      {% for p in range(1, pages+1) %}
      <li class="page-item {% if p == page %}active{% endif %}"><a class="page-link" href="?movie={{ filters.movie }}&theatre={{ filters.theatre }}&date={{ filters.date }}&page={{ p }}">{{ p }}</a></li>
      {% endfor %}
      <li class="page-item {% if page >= pages %}disabled{% endif %}">
        <a class="page-link" href="?movie={{ filters.movie }}&theatre={{ filters.theatre }}&date={{ filters.date }}&page={{ page+1 }}">Next</a>
      </li>
    </ul>
  </nav>
  {% endif %}
{% else %}
  <div class="alert alert-info">No shows found for the selected filters.</div>
{% endif %}
{% endblock %}

